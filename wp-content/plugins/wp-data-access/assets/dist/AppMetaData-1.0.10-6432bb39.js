import{r as o,j as e,W as $,l as c,X as q,Y as H,Z as U,$ as X,a0 as Y,a1 as Z,a2 as G,a3 as J,a4 as K,z as L,a5 as Q,e as k,C as S,A as V,a6 as I}from"./main-1.0.10.js";import{B as A,b as C,u as v,s as ee,T as O,t as te,D as w,i as se,w as ae,R as ne,C as pe,v as re,x as oe,S as z,p as ie,A as le,e as ce,f as ue,y as R,z as N,E as de}from"./main-1.0.10-f52b9bd1.js";import{b as me}from"./ActionsApp-1.0.10-3d5dae5f.js";import xe from"./Alert-1.0.10-a43fcfe4.js";import{I as E}from"./iconBase-1.0.10-ed1594d9.js";import{M as ge}from"./MenuItem-1.0.10-7183fe69.js";import{M as he}from"./Menu-1.0.10-18fe74ce.js";import{a as fe}from"./AdminTheme-1.0.10-77503373.js";const Ae=({appId:t,appDbId:s,isVisible:r,fullScreen:p})=>{const[x,g]=o.useState(!1);return o.useEffect(()=>{r&&!x&&g(!0)},[r]),x?e.jsx(A,{className:r?"pp-app-show":"pp-app-hide",sx:{"& .pp-app-container .pp-component header":{margin:0},"& .pp-app-container .pp-component header *":{visibility:"hidden",position:"fixed"}},children:e.jsx(Me,{appId:t,appDbId:s,fullScreen:p})}):null},je=t=>{const s=C(r=>$(r,t));return c.debug("appData",s),s},Se=({appId:t})=>{const s=v(),r=ee(t),p=je(t);return e.jsx(O,{title:e.jsx(te,{details:r,mode:p==null?void 0:p.mode}),className:"pp-builder-button",children:e.jsx(E,{sx:{color:"inherit",padding:0},onClick:()=>{(p==null?void 0:p.mode)===w.FORM?s(q({appId:t})):s(H({appId:t}))},children:e.jsx(se,{})})})},be=({appDbId:t,appTitle:s,setActiveApp:r,handleClose:p})=>e.jsx(ge,{onClick:()=>{r(t),p()},children:e.jsx("span",{children:s})}),ye=({apps:t,setActiveApp:s})=>{const[r,p]=o.useState(null),x=!!r,g=m=>{p(m.currentTarget),m.stopPropagation()},a=()=>{p(null)};return e.jsxs(A,{sx:{position:"relative"},children:[e.jsx(E,{sx:{color:"inherit",padding:0},onClick:g,children:e.jsx(ae,{})}),e.jsxs(he,{anchorEl:r,disablePortal:!0,open:x,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 18px !important"}},children:[...t.apps.map(m=>e.jsx(be,{appDbId:m,appTitle:t.titles[m],setActiveApp:s,handleClose:a}))]})]})},Ce=({appId:t})=>{var F,P,D;c.debug(t);const s=v(),r=ne(),p=pe(),x=o.useRef(null),g=o.useRef(null),a=C(n=>U(n,t));c.debug("apps",a);const m=C(n=>X(n));c.debug("themes",m);const i=o.useMemo(()=>{const n={};return Array.isArray(a.apps)&&a.apps.length>0&&a.apps.map(y=>{n[y]=re()}),n},[]),j=oe(t,(P=(F=a==null?void 0:a.appSettings)==null?void 0:F.settings)==null?void 0:P.app_language);c.debug(j,t);const u=o.useMemo(()=>Y(Z.getState(),t),[]),b=o.useMemo(()=>{var n,y;return((y=(n=u==null?void 0:u.app)==null?void 0:n.app[0])==null?void 0:y.app_title)!==""?u.app.app[0].app_title:"WP Data Access"},[]),[f,M]=o.useState((a==null?void 0:a.apps[0])??0);c.debug(f);const T=fe(),[h,B]=o.useState(!1);c.debug("appFullScreen",h);const d=C(n=>G(n));c.debug("appData",d),o.useEffect(()=>{c.debug("setFullScreen",i,h),Object.keys(i).map(n=>{s(J({appId:i[Number(n)],fullScreen:h}))})},[d,h]);const l=((D=d[i[f]])==null?void 0:D.mode)??w.TABLE;c.debug("mode",l);let _={};const W=()=>null;return a===void 0||Object.keys(i).length===0?e.jsx(z,{}):e.jsx(ie,{theme:T,children:e.jsxs(A,{className:"pp-apps-container",ref:x,sx:{...h?_:{},"& .pp-app-hide *":{visibility:"hidden",position:"fixed"}},children:[e.jsx(le,{className:"pp-apps-header",ref:g,position:"relative",sx:{margin:"0 0 5px 0"},children:e.jsxs(ce,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(A,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"}},children:[e.jsx("span",{children:e.jsx(ye,{apps:a,setActiveApp:M})}),e.jsxs("span",{children:[b," - ",a.titles[f]]})]}),e.jsxs(A,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[K(u)&&e.jsx(Se,{appId:i[f]}),W(),(u==null?void 0:u.isExploring)&&e.jsx(O,{title:j.close,children:e.jsx(E,{sx:{color:"inherit",padding:0},onClick:()=>{s(L({isActive:!1,appDbId:0})),p(t),r(t),s(Q({})),Object.keys(i).map(n=>{p(i[n]),r(i[n])})},children:e.jsx(ue,{})})})]})]})}),...a.apps.map(n=>e.jsx(Ae,{appId:i[n],appDbId:n,isVisible:n===f,fullScreen:h}))]})})},Me=({appId:t,appDbId:s,designMode:r,staticFilter:p,shortcodeArgs:x,fullScreen:g,isExploring:a})=>{c.debug(t,s,r,p,x,g,a);const m=v(),[i,j]=o.useState(""),[u,b]=o.useState(!1),[f,M]=o.useState(!1),{prepareAppStore:T}=R(t,N.APP),{prepareApp:h}=R(t,N.APP);o.useEffect(()=>{u||B()},[s]);const B=()=>{me(s,d=>{const l=d==null?void 0:d.data;c.debug("response data",l),l.app&&l.app.app&&Array.isArray(l.app.app)&&l.app.container&&Array.isArray(l.app.container)&&l.app.apps&&Array.isArray(l.app.apps)?l.app.app[0].app_type===V.APPCONTAINER.toString()?(h(l,a),M(!0),b(!0)):T(s,l,r===!0,void 0,g??!1)?(m(I({appId:t,staticFilter:p,shortcodeArgs:x})),b(!0)):j(S.contactSupport):(k(S.contactSupport,{variant:"error"}),j(S.contactSupport))},d=>{c.error("error",d),k(d??S.contactSupport,{variant:"error"}),j(d??S.contactSupport)})};return i!==""?e.jsx(o.Suspense,{children:e.jsx(xe,{severity:"error",message:i,close:!0,setClose:()=>{m(L({isActive:!1,appDbId:0}))}})}):u?f?e.jsx(Ce,{appId:t}):e.jsx(A,{id:"pp-app-"+t,className:"pp-app-container pp-app-"+s,sx:{[`&#pp-app-${t} .pp-column-search-field ul`]:{marginLeft:0,padding:0},[`&#pp-app-${t} .pp-form form input`]:{boxSizing:"content-box"}},children:e.jsx(de,{appId:t})}):e.jsx(A,{sx:{padding:"50px"},children:e.jsx(z,{})})};export{Me as A};
