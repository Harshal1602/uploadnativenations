import{j as e,cE as Y,l as g,r as M,a0 as $,a1 as Z,cF as I,bW as D,b$ as x,cG as ee,bs as se,cH as ie,cI as te,cJ as ae,cK as ne,F as f,cL as re,cM as oe,cN as le,cO as de,cP as ce,cQ as me}from"./main-1.0.10.js";import{u as C,S as pe,a as ue,I as H,b as xe,c as ge,d as V,D as he,e as je,f as fe,g as be,h as ye,T as Se,M as ke,P as ve}from"./useMetadataColumns-1.0.10-77c1f86c.js";import{u as w,B as c,b as W,M as O,a as Te,c as Ae,ae as we,af as Ee,ag as Ne,q as Pe,ah as Me,ai as Le,aj as De,ak as Fe,al as Ce,am as Oe,D as Re}from"./main-1.0.10-f52b9bd1.js";import{h as Be}from"./index.esm-1.0.10-fc952eac.js";import{S,a as N,C as Ue}from"./settings-1.0.10-7d354621.js";import{u as E}from"./useTableUpdater-1.0.10-9bb30d78.js";import{b as A,F as v,a as T,T as L,A as Ge}from"./TextField-1.0.10-1c88e8ee.js";import{a as Q}from"./ScopeEnum-1.0.10-dd8f976d.js";import{P as z}from"./PremiumFeature-1.0.10-d8bec116.js";import{A as X}from"./AdminTheme-1.0.10-77503373.js";import{b as _e,c as He,a as Ve}from"./index.esm-1.0.10-4b5803af.js";import{A as R,a as B,b as U,L as We}from"./Link-1.0.10-0c622c62.js";import{F as k}from"./FormControlLabel-1.0.10-8c056e28.js";import{R as ze}from"./RadioGroup-1.0.10-ba763186.js";import{R as F}from"./Radio-1.0.10-5d5f37f5.js";import{A as b,a as y}from"./TableContainer-1.0.10-0d1a9d63.js";import{C as qe}from"./Checkbox-1.0.10-8b17dcc2.js";import{I as P}from"./iconBase-1.0.10-ed1594d9.js";import"./useStoreTable-1.0.10-1f5643a1.js";import"./CardContent-1.0.10-fdbae602.js";import"./ActionsDml-1.0.10-1992820f.js";import"./MenuItem-1.0.10-7183fe69.js";import"./Menu-1.0.10-18fe74ce.js";import"./index-1.0.10-ab8af271.js";import"./Stepper-1.0.10-17f5c392.js";import"./Close-1.0.10-2cc4e9e5.js";import"./DialogContent-1.0.10-806b7ca9.js";import"./Tabs-1.0.10-904035cb.js";import"./useSlot-1.0.10-af1d07b4.js";import"./index.esm-1.0.10-91acd807.js";import"./AlertTitle-1.0.10-f0717848.js";import"./InputAdornment-1.0.10-5eb89e09.js";import"./DateTimePicker-1.0.10-db68855b.js";import"./useMobilePicker-1.0.10-2b3a8dee.js";import"./date-time-utils-1.0.10-67dd3a9e.js";import"./dateViewRenderers-1.0.10-487cb75d.js";import"./TimePicker-1.0.10-83f68f18.js";import"./DatePicker-1.0.10-5198465d.js";import"./index-1.0.10-78ba36f8.js";const Qe=({appId:i,columnIndex:r,tableColumn:s})=>{const a=w(),d=E(i);return e.jsxs(c,{sx:{margin:"0 1rem 2rem 1rem"},children:[e.jsx(A,{children:"Width"}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gridGap:"30px",alignItems:"center"},children:[e.jsx(Q,{min:60,max:420,step:1,value:s.width,marks:[{value:60,label:"60"},{value:120,label:"120"},{value:180,label:"180"},{value:240,label:"240"},{value:300,label:"320"},{value:360,label:"360"},{value:420,label:"420"}],valueLabelDisplay:"auto",onChange:(t,l)=>{a(Y({appId:i,index:r,width:l})),d(!0),t.stopPropagation()}}),e.jsx("span",{children:"px"})]})]})},Xe=({appId:i,columnIndex:r,tableColumn:s})=>{var j,o,h;g.debug(i,r,s),w();const a=M.useMemo(()=>$(Z.getState(),i),[]);C(i,a);const[d,t]=M.useState(!1),l=W(p=>I(p,i));M.useState(!1),E(i);const m=!0;return e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(_e,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column actions"})]}),e.jsxs(U,{sx:{display:"grid",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{margin:"0 10px",display:"grid",gridTemplateColumns:"auto"},children:[s.computedField?e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0}),label:"Enable inline search",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(S,{checked:s.inlineSearch&&!m,disabled:m,onChange:(p,G)=>{p.stopPropagation()}}),label:"Enable column filter",labelPlacement:"end"}),s.inlineSearch&&!m&&e.jsxs(c,{children:[e.jsxs(ze,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"20px",marginTop:"10px",marginBottom:"10px"},children:[e.jsxs(A,{className:"align-label-radio",children:[e.jsx(F,{checked:s.inlineSearchEnum===D.SEARCHBOX,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Searchbox"]}),e.jsxs(A,{className:"align-label-radio",children:[e.jsx(F,{checked:s.inlineSearchEnum===D.DROPDOWN,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Drop-down list"]}),e.jsxs(A,{className:"align-label-radio",children:[e.jsx(F,{checked:s.inlineSearchEnum===D.MULTISELECT,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Multi-select drop-down list"]}),e.jsxs(A,{className:"align-label-radio",children:[e.jsx(F,{checked:s.inlineSearchEnum===D.SEARCHPANE,disabled:!0,onChange:p=>{p.stopPropagation()}}),"Search pane"]})]}),s.lookup!==void 0&&((j=s.lookup)==null?void 0:j.loadOnStartup)!==!0&&e.jsx(v,{sx:{marginBottom:"20px",marginLeft:"5px"},children:e.jsxs(T,{sx:{color:(o=X)==null?void 0:o.palette.error.main,"& svg":{marginRight:"5px",verticalAlign:"middle"}},children:[e.jsx(Te,{size:"18px"}),e.jsx("span",{children:"Drop-down lists are only supported for lookups loaded into memory on startup."})]})}),e.jsx(L,{fullWidth:!0,type:"number",label:"Order",value:s.columnFilterOrder,helperText:"Position of column filter in search panel.",disabled:!0,onChange:p=>{p.stopPropagation()},sx:{marginLeft:"15px",marginBottom:"20px"}})]}),((h=a==null?void 0:a.privs)==null?void 0:h.update)&&a.primary_key.length>0&&e.jsx(e.Fragment,{children:!s.computedField&&!s.columnName.startsWith("d.")?e.jsx(k,{control:e.jsx(S,{checked:l&&s.visible&&s.inlineEditing,disabled:!0,onChange:(p,G)=>{p.stopPropagation()}}),label:"Enable inline editing",labelPlacement:"end"}):e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0}),label:"Enable inline editing",labelPlacement:"end"})})]}),!1,e.jsxs(T,{component:"div",sx:{marginTop:"30px"},children:[e.jsx(c,{children:e.jsxs(We,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>t(!d),children:[e.jsx(Ae,{}),"What are column actions?"]})}),d&&e.jsxs(c,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(c,{children:"Column actions are inline actions added to a table column to enhance usability and user-friendliness."}),e.jsx(c,{children:e.jsx("strong",{children:"Column filtering"})}),e.jsx(c,{children:"When column filtering is enabled, a search field is added to the table for performing column-specific searches. A search box allows wildcard searches, while drop-down lists perform exact searches. Exact searches can improve performance, especially when the searched columns are well-indexed."}),e.jsx(c,{children:"To enable the column filter feature, go to the TABLE section under Column Filters. You can also change the position of the column filters."}),e.jsx(c,{children:"The global filter performs a wildcard search. This feature can be disabled in the TABLE section under Global filter."}),e.jsx(c,{children:e.jsx("strong",{children:"Inline editing"})}),e.jsx(c,{children:"Inline editing allows users to change table columns directly, without needing to open a data entry form. This feature is not available for primary key fields. Drop-down lists are automatically generated for enum and set data types."})]})]}),e.jsx(z,{})]})]})},Je=({appId:i,columnIndex:r,tableColumn:s})=>{var m,j;const a=w(),d=E(i),t=C(i),l=(o,h)=>{g.debug(o,h)};return e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(He,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(U,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto"},children:[e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:o=>{l(r,!s.visibleTablet),o.stopPropagation()}}),label:"Show column on tablet",labelPlacement:"end"}),e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:o=>{o.stopPropagation()}}),label:"Show column on mobile",labelPlacement:"end"})]}),(s.computedField||t[s.columnName]!==void 0&&(x(t[s.columnName].data_type)==="float"||x(t[s.columnName].data_type)==="number"||x(t[s.columnName].data_type)==="time"||x(t[s.columnName].data_type,!0)==="date"||x(t[s.columnName].data_type,!0)==="datetime"||x(t[s.columnName].data_type,!0)==="timestamp"))&&e.jsx(c,{children:e.jsxs(v,{children:[e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:o=>{o.stopPropagation()}}),label:"Localize",labelPlacement:"end"}),e.jsx(T,{children:s.computedField||t[s.columnName]!==void 0&&(x(t[s.columnName].data_type)==="float"||x(t[s.columnName].data_type)==="number")?"Localizes decimal and thousands seperators (does not affect inline fields).":"Localizes date and time fields  (does not affect inline fields)."})]})}),(t[s.columnName]!==void 0&&x(t[s.columnName].data_type,!0)==="float"||s.computedField!==void 0)&&e.jsxs(v,{children:[e.jsx(A,{children:"Decimals"}),e.jsx(Q,{min:0,max:6,value:s.decimals,marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"∞"}],valueLabelDisplay:"auto",disabled:!0,onChange:(o,h)=>{g.debug(h),o.stopPropagation()}}),e.jsx(T,{children:"Number of decimals displayed."})]}),t[s.columnName]!==void 0&&s.localize&&(x(t[s.columnName].data_type,!0)==="datetime"||x(t[s.columnName].data_type,!0)==="timestamp")&&e.jsx(c,{children:x(t[s.columnName].data_type)==="date"&&e.jsx(v,{children:e.jsx(k,{control:e.jsx(S,{checked:!1,disabled:!0,onClick:o=>{o.stopPropagation()}}),label:"Add trailing zeros to days and month",labelPlacement:"end"})})}),e.jsxs(v,{children:[e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:[e.jsx(L,{type:"text",variant:"outlined",label:"Prefix",value:s.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:o=>{o.stopPropagation()}}),e.jsx(L,{type:"text",variant:"outlined",label:"Suffix",value:s.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:o=>{o.stopPropagation()}})]}),e.jsx(T,{children:"Adds a prefix and/or suffix to the column content (also added to inline text and number fields)."})]}),e.jsxs(v,{children:[e.jsx(L,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:s.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:o=>{o.stopPropagation()}}),e.jsx(T,{children:"CSS classes (seperated by spaces) for custom styling."})]}),e.jsxs(v,{children:[e.jsx(k,{control:e.jsx(S,{checked:s.allowMarkup,onChange:(o,h)=>{a(ee({appId:i,index:r,allowMarkup:h})),d(!0),o.stopPropagation()}}),label:"Allow inline HTML",labelPlacement:"end"}),e.jsxs(T,{children:["Allows markup in column content. ",e.jsx("span",{style:{...s.allowMarkup&&{color:((j=(m=X)==null?void 0:m.palette)==null?void 0:j.error.main)??"red"}},children:"Enabling this feature may pose a risk of cross-site scripting (XSS) attacks."})]})]}),e.jsx(z,{single:!1,margin:"0"})]})]})},Ke=[{key:b.SUM,label:y.SUM},{key:b.MIN,label:y.MIN},{key:b.MAX,label:y.MAX},{key:b.AVG,label:y.AVG},{key:b.COUNT,label:y.COUNT},{key:b.UNIQUE,label:y.UNIQUE},{key:b.STD,label:y.STD},{key:b.VARIANCE,label:y.VARIANCE},{key:b.MEDIAN,label:y.MEDIAN}],q=[...Ke],Ye=({appId:i,columnIndex:r,tableColumn:s})=>{g.debug(i,r,s),w(),E(i);const a=C(i),d=M.useMemo(()=>{var t;return(s==null?void 0:s.aggregation)===void 0?[]:(t=s==null?void 0:s.aggregation)==null?void 0:t.map(l=>q.filter(m=>m.key===l)[0])},[s==null?void 0:s.aggregation]);return!se(i)||s.computedField===void 0&&x(a[s.columnName].data_type)!=="number"?null:e.jsxs(R,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(O,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Ve,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Aggregations"})]}),e.jsxs(U,{sx:{marginTop:"10px"},children:[e.jsxs(v,{fullWidth:!0,children:[e.jsx(Ge,{multiple:!0,options:q,disabled:!0,disableCloseOnSelect:!0,getOptionLabel:t=>t.label,value:d,onChange:(t,l)=>{t.stopPropagation()},renderOption:(t,l,{selected:m})=>e.jsxs("li",{...t,children:[e.jsx(qe,{icon:e.jsx(we,{}),checkedIcon:e.jsx(Ee,{}),style:{marginRight:8},checked:m}),l.label]}),renderInput:t=>e.jsx(L,{...t,label:"Select from list"})}),e.jsx(T,{children:"Allows multiple selections. Displayed in order of entry."})]}),e.jsx(z,{})]})]})},$e=({appId:i,columnIndex:r,tableColumn:s})=>{g.debug(i,r,s);const a=w(),d=E(i),l=C(i)[s.columnName],m=(j,o)=>{a(ie({appId:i,columnName:s.columnName})),a(te({appId:i,columnName:s.columnName})),a(ae({appId:i,index:j,lookup:o})),d(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{appId:i,columnIndex:r,tableColumn:s}),e.jsx(Je,{appId:i,columnIndex:r,tableColumn:s}),e.jsx(Xe,{appId:i,columnIndex:r,tableColumn:s}),e.jsx(pe,{appId:i,columnIndex:r,tableColumn:s,columnMetaData:l,setLookup:m}),e.jsx(Ye,{appId:i,columnIndex:r,tableColumn:s}),e.jsx(ue,{columnMetaData:l})]})},Ze=({appId:i,columnIndex:r})=>{g.debug(i,r);const s=w(),a=W(n=>ne(n,i,r));g.debug("tableColumn",a);const d=E(i),[t,l]=M.useState(!1),[m,j]=M.useState(void 0),o=n=>{n!==void 0&&(s(re({appId:i,index:n})),d(!0))},h=(n,u)=>{g.debug(n,u),s(oe({appId:i,index:n,visible:u})),d(!0)},p=(n,u)=>{g.debug(n,u),s(le({appId:i,index:n,queryable:u})),d(!0)},G=(n,u)=>{g.debug(n,u),s(de({appId:i,index:n,orderable:u})),d(!0)},_=(n,u)=>{s(ce({appId:i,index:n,alignment:u})),d(!0)},J=(n,u,K)=>(g.debug(n,u,K),e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{"& svg":{pointerEvents:"none",opacity:"0.5"}},children:e.jsx(xe,{id:n,enabled:!1},n)}),e.jsxs(c,{sx:{display:"inline-grid",gridTemplateColumns:a.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[a.computedField!==void 0&&e.jsx(Be,{}),e.jsx(A,{children:u})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(R,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(B,{className:"pp-column-settings",expandIcon:e.jsx(O,{}),sx:{justifyContent:"space-between"},children:[e.jsx(c,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:J(a.columnName,a.columnLabel,r)}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"40px 40px 40px 40px"},children:[e.jsx(N,{title:"Visibility",position:"bottom",children:e.jsx(P,{onClick:n=>{h(r,!a.visible),n.stopPropagation()},children:e.jsx(H,{checked:a.visible,children:e.jsx(Ne,{})})})}),a.computedField?e.jsx(N,{title:"Edit",position:"bottom",children:e.jsx(P,{onClick:n=>{n.stopPropagation()},children:e.jsx(Me,{})})}):e.jsx(N,{title:"Searchable",position:"bottom",children:e.jsx(P,{onClick:n=>{p(r,!a.queryable),n.stopPropagation()},children:e.jsx(H,{checked:a.queryable,alignRight:!1,children:e.jsx(Pe,{})})})}),a.computedField?e.jsx(N,{title:"Delete",position:"bottom",children:e.jsx(P,{onClick:n=>{j(r),l(!0),n.stopPropagation()},children:e.jsx(De,{})})}):e.jsx(N,{title:"Sortable",position:"bottom",children:e.jsx(P,{onClick:n=>{G(r,!a.orderable),n.stopPropagation()},children:e.jsx(H,{checked:a.orderable,children:e.jsx(Le,{})})})}),e.jsx(N,{title:"Alignment",position:"bottom",children:e.jsxs(P,{onClick:n=>{a.alignment===f.LEFT?_(r,f.CENTER):a.alignment===f.CENTER?_(r,f.RIGHT):a.alignment===f.RIGHT&&_(r,f.LEFT),d(!0),n.stopPropagation()},children:[a.alignment===f.LEFT&&e.jsx(Fe,{}),a.alignment===f.CENTER&&e.jsx(Ce,{}),a.alignment===f.RIGHT&&e.jsx(Oe,{})]})})]})]}),e.jsx(U,{children:e.jsx($e,{appId:i,columnIndex:r,tableColumn:a})})]},r),e.jsx(Ue,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:t,setOpen:l,onConfirm:()=>o(m)})]})},Us=({appId:i,metaData:r})=>{g.debug(i,r),w();const s=ge(V(ve),V(ke),V(Se));E(i);const a=t=>{const{active:l,over:m}=t;g.debug(l,m),l==null||l.id,m==null||m.id},d=W(t=>me(t,i));return d===void 0||d.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(he,{autoScroll:!0,sensors:s,collisionDetection:je,onDragEnd:a,children:e.jsx(fe,{items:d,children:d.map((t,l)=>e.jsx(be,{id:t,children:e.jsx(Ze,{appId:i,columnIndex:l})},t))})}),e.jsx(ye,{appId:i,target:Re.TABLE})]})};export{Us as default};
